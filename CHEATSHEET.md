# Simplyment - Cheatsheet

## Configuration
Include static "Simplyment template" (already defining page=PAGE with 10=FLUIDTEMPLATE using template resolver).

Custom page=PAGE configuration possible - template resolver:
```typoscript
templateName < simplyment.page.resolveTemplateName
```

Add in ext_localconf.php:
```php
\OrangeHive\Simplyment\Loader::extLocalconf(
  vendorName: 'MyVendorName',
  extensionName: 'my_extension_key'
);
```
Add in ext_tables.php
```php
\OrangeHive\Simplyment\Loader::extTables(
  vendorName: 'MyVendorName',
  extensionName: 'my_extension_key'
);
```


## Usage

### BackendLayouts

|                |                                                         |
|----------------|---------------------------------------------------------|
| Location       | EXT:<MY_EXTENSION>\Resources\Private\BackendLayouts     |
| Filename       | lower_snake_case                                        |
| File extension | .ts, .tsconfig, .typoscript, .txt                       |
| Fluid file     | UpperCamelCase, searched in specified TemplateRootPaths |
| Render colPos  | ``<f:cObject typoscriptObjectPath="lib.dynamicContent" data="{colPos: '0'}" />`` |


<details>
  <summary>Example</summary>

```typoscript
{
    title = My title
    description = My template description
    icon = EXT:my_extension/Resources/Public/Images/BackendLayouts/default.png
    config {
        backend_layout {
            colCount = 1
            rowCount = 1
            rows {
                1 {
                    columns {
                        1 {
                            name = LLL:EXT:my_extension/Resources/Private/Language/locallang_be.xlf:backend_layout.column.normal
                            colPos = 0
                        }
                    }
                }
            }
        }
    }
}
```
</details>

<br />

### Plugins

|                                            |                                                                |
|--------------------------------------------|----------------------------------------------------------------|
| Location                                   | EXT:<MY_EXTENSION>\Classes\Controller                          |
| PHP attribute on class                     | Plugin                                                         |
| PHP attribute on action methods            | PluginAction                                                   |
| Flexform default path                      | EXT:my_extension/Configuration/FlexForms/MyPluginName.xml      |
| Configuration/TCA/Overrides/tt_content.php | ``\OrangeHive\Simplyment\Loader::tcaTtContentOverrides('MyVendorName', 'my_extension_key'); ``  |


<details>
  <summary>Example</summary>

```php
#[Plugin(
    name: 'MyPlugin',
    description: 'MyDescription (could be an LLL)'
)]
class PluginTestController extends ActionController
{

    #[PluginAction(pluginName: 'MyPlugin', noCache: true)]
    public function indexAction()
    {
    }
```

</details>

<br />

### Database models

|                                    |                                                                      |
|------------------------------------|----------------------------------------------------------------------|
| Location                           | EXT:<MY_EXTENSION>\Domain\Model                                      |
| PHP attribute on class             | DatabaseTable                                                        |
| PHP attributes on custom properties | DatabaseField, TcaField                                              |
| TCA file | EXT:<MY_EXTENSION>\Configuration\TCA - autogenerated with table name |

<br />

#### Extending existent tables
add tableName of table which should be extended in PHP attribute DatabaseTable


|                                    |                                                                                |
|------------------------------------|------------------------------------------------------------------|
| TCA file | EXT:<MY_EXTENSION>\Configuration\TCA\Overrides - autogenerated with table name |

<details>
  <summary>Example</summary>

```php
<?php

namespace MyVendor\MyExtension\Domain\Model;

use OrangeHive\Simplyment\Attributes\DatabaseField;
use OrangeHive\Simplyment\Attributes\DatabaseTable;
use OrangeHive\Simplyment\Attributes\TcaField;
use TYPO3\CMS\Extbase\DomainObject\AbstractEntity;

#[DatabaseTable(
    tableName: 'pages' // extending table 'pages'
)]
class Page extends AbstractEntity
{

    protected string $title = ''; // already existent field title

    #[DatabaseField(type: 'text')]
    #[TcaField]
    protected string $txMyField; // custom field

    /**
     * @return string
     */
    public function getTitle(): string
    {
        return $this->title;
    }

    /**
     * @return string
     */
    public function getTxMyField(): string
    {
        return $this->txMyField;
    }

}
```
</details>

<br />

#### Relations with ObjectStorage

<details>
  <summary>Example</summary>

```php
/**
 * @var \TYPO3\CMS\Extbase\Persistence\ObjectStorage<\MyVendor\MyExtension\Domain\Model\MySubModel>
 */
#[DatabaseField(sql: 'int')]
#[TcaField(
    label: 'Sub models',
    type: TcaFieldTypeEnum::INLINE,
    targetClass: TestSubModel::class
)]
protected ObjectStorage $subModels;
```
</details>

<br />

There are predefined types for referencing FAL files (TcaFieldTypeEnum::FILE) , images (TcaFieldTypeEnum::FILE_IMAGE) or media (TcaFieldTypeEnum::FILE_MEDIA).

<details>
  <summary>Example for referencing only images through FAL</summary>

```php
/**
 * @var \TYPO3\CMS\Extbase\Persistence\ObjectStorage<\TYPO3\CMS\Extbase\Domain\Model\FileReference>
 */
#[DatabaseField(sql: 'int')]
#[TcaField(
    label: 'My images',
    type: TcaFieldTypeEnum::FILE_IMAGE
)]
protected ObjectStorage $images;
```
</details>

<br />

### Custom content elements

|                                               |                                                                                               |
|-----------------------------------------------|-----------------------------------------------------------------------------------------------|
| Location                                      | EXT:<MY_EXTENSION>\Domain\Model\Content                                                       |
| PHP attribute on class                        | ContentElement                                                                                |
| Configuration/TCA/Overrides/tt_content.php    | ``\OrangeHive\Simplyment\Loader::tcaTtContentOverrides('MyVendorName', 'my_extension_key'); `` |
 | Configuration\Extbase\Persistence\Classes.php | autogenerated |
 | Template path | EXT:<MY_EXTENSION>/Resources/Privat/Templates/Content/ |

<details>
  <summary>Example</summary>

```php

<?php

namespace MyVendor\MyExtension\Domain\Model\Content;

use OrangeHive\Simplyment\Attributes\ContentElement;
use OrangeHive\Simplyment\Attributes\DatabaseField;
use OrangeHive\Simplyment\Attributes\TcaField;
use OrangeHive\Simplyment\Enumeration\TcaFieldTypeEnum;
use TYPO3\CMS\Extbase\DomainObject\AbstractEntity;

#[ContentElement(
    name: 'Teaser'
)]
class Teaser extends AbstractEntity
{

    protected string $header = ''; // use already existent header field

    #[TcaField(
        type: TcaFieldTypeEnum::TEXT,
        config: [
            'enableRichtext' => true,
        ]
    )]
    protected string $bodytext = ''; // use already existent bodytext field and define it as type='text' with richtext enabled

    #[TcaField(
        type: TcaFieldTypeEnum::TEXT,
        config: [
            'enableRichtext' => true,
        ]
    )]
    #[DatabaseField(type: 'mediumtext')]
    protected string $txAdditionalText = ''; // create custom field tx_additional_text and define it as type='text' with richtext enabled

    /**
     * @return string
     */
    public function getHeader(): string
    {
        return $this->header;
    }

    /**
     * @return string
     */
    public function getBodytext(): string
    {
        return $this->bodytext;
    }

    /**
     * @return string
     */
    public function getTxAdditionalText(): string
    {
        return $this->txAdditionalText;
    }

}
```

</details>

<br />

### Hooks

|                                               |                                       |
|-----------------------------------------------|---------------------------------------|
| Location                                      | EXT:<MY_EXTENSION>\Hook |
| PHP attribute on class | Hook |

<details>
  <summary>Example</summary>

```php
#[Hook(identifier: 'TYPO3_CONF_VARS/SC_OPTIONS/BackendLayoutDataProvider', key: 'simplyment')]
class BackendLayoutDataProvider implements DataProviderInterface
{

}
```

</details>